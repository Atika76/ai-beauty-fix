<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AI Beauty Fix ‚Äî Fot√≥retus√°l√°s</title>
  <meta name="description" content="AI fot√≥-retus√°l√°s ‚Äî 3 ingyenes k√©p/nap v√≠zjellel.">

  <!-- Favicons (t√∂ltsd fel a logo-*.png f√°jlokat a repo gy√∂ker√©be) -->
  <link rel="icon" type="image/png" sizes="16x16" href="logo-16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="logo-32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="logo-180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="logo-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="logo-512.png">
  <link rel="manifest" href="site.webmanifest">

  <!-- PayPal JS SDK (client-id: amit adt√°l) -->
  <script src="https://www.paypal.com/sdk/js?client-id=AQsaQCLj0og2wsfMoDKAqxJieD2cgXwWq5cssAJCJbO2KoYE8LGHCREyR4vMzMfKZK68qw6EY7IAxMYF&currency=HUF"></script>

  <style>
    :root{--accent:#7c3aed;--bg1:#071022;--card:#0b1220;--muted:#9fb0c7}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,var(--bg1),#08142a);color:#eaf4ff}
    .wrap{max-width:1100px;margin:28px auto;padding:18px}
    header{display:flex;align-items:center;gap:12px}
    header img{width:64px;height:64px;border-radius:12px}
    h1{margin:0;font-size:20px}
    .lead{color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:18px}
    .card{background:var(--card);padding:18px;border-radius:14px;box-shadow:0 10px 28px rgba(0,0,0,0.45)}
    .btn{display:inline-block;padding:10px 14px;border-radius:10px;background:var(--accent);color:white;text-decoration:none;font-weight:700;border:none;cursor:pointer}
    .mutebtn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px 12px;border-radius:10px}
    label{display:block;margin-top:12px;font-weight:700}
    input[type=file]{display:block;margin-top:8px}
    #preview,#resultImg{max-width:100%;border-radius:10px;display:block;margin-top:12px}
    .watermark{position:absolute;left:12px;bottom:12px;padding:6px 10px;background:rgba(0,0,0,0.35);border-radius:8px;font-weight:700}
    footer{margin-top:20px;color:var(--muted);font-size:13px;text-align:center}
    @media(max-width:900px){.grid{grid-template-columns:1fr} header img{width:56px;height:56px}}
    #paypal-button-container { margin-top: 10px; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="logo.png" alt="AI Beauty Fix logo" id="siteLogo" onerror="this.style.display='none'">
      <div>
        <h1>üî• AI Beauty Fix</h1>
        <div class="lead">Gyors AI fot√≥-retus√°l√°s ‚Äî 3 ingyenes k√©p/nap (v√≠zjellel)</div>
      </div>
      <nav style="margin-left:auto">
        <a href="#upload" onclick="showView('upload')" class="muted">Felt√∂lt√©s</a>
        <a href="#pricing" onclick="showView('pricing')" class="muted" style="margin-left:12px">√Årak</a>
        <a href="#admin" onclick="showView('admin')" class="muted" style="margin-left:12px">Admin</a>
      </nav>
    </header>

    <main class="grid">
      <section class="card" id="uploadSection">
        <h2>Felt√∂lt√©s & Retus√°l√°s</h2>
        <p class="muted">Max 20 MB / k√©p. Ingyenes fi√≥k: <strong>3 ingyenes retus / nap</strong> (v√≠zjellel).</p>

        <label for="fileInput">V√°lassz k√©pet (JPG/PNG)</label>
        <input id="fileInput" type="file" accept="image/*">
        <canvas id="canvas" style="display:none"></canvas>
        <img id="preview" src="#" alt="preview" style="display:none">

        <label>Opci√≥</label>
        <select id="optionSelect">
          <option value="free">Ingyenes retus (v√≠zjellel)</option>
          <option value="credit">Haszn√°lj kreditet (v√≠zjel n√©lk√ºl)</option>
          <option value="paynow">Fizess egy k√©pet</option>
        </select>

        <div style="margin-top:12px">
          <button class="btn" id="processBtn">Retus√°l√°s ind√≠t√°sa</button>
          <button class="mutebtn" onclick="showView('pricing')" style="margin-left:8px">Kredit v√°s√°rl√°s / El≈ëfizet√©s</button>
          <span id="status" class="muted" style="margin-left:10px"></span>
        </div>

        <div id="resultWrap" style="margin-top:16px;display:none;position:relative">
          <h3>Eredm√©ny</h3>
          <img id="resultImg" src="#" alt="result">
          <div id="wmTag" class="watermark" style="display:none">AI Beauty Fix ‚Äî DEMO (V√çZJEL)</div>
          <div style="margin-top:10px">
            <a id="downloadBtn" class="btn" download>Let√∂lt√©s</a>
          </div>
        </div>
      </section>

      <aside class="card" id="pricingSection" style="display:none">
        <h3>√Årak & Csomagok</h3>
        <p class="muted">1 retus = 1 kredit. V√°laszd a csomagot ‚Äî a PayPal gomb a fizet√©shez visz.</p>

        <!-- Kredit csomagok (PayPal gomb alatt a JS hozza l√©tre a rendel√©sek szerverrel) -->
        <div id="paypal-button-container"></div>

        <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.04)">

        <h4>Manu√°lis fizet√©s (linkek csak demo c√©lra)</h4>
        <p class="muted">10 retus ‚Äî 1490 Ft ¬∑ 20 retus ‚Äî 2490 Ft ¬∑ 50 retus ‚Äî 4990 Ft</p>
      </aside>
    </main>

    <div id="admin" class="card" style="margin-top:18px;display:none">
      <h2>Admin</h2>
      <p class="muted">Admin jelsz√≥ be√°ll√≠t√°s (ez a kliens-oldali gyors bel√©p≈ë ‚Äî a szerveroldalon is √°ll√≠tsd be az ADMIN_SECRET-et ugyanarra):</p>
      <div style="margin-top:8px">
        <button class="btn" onclick="setAdminMode()">Admin bel√©p√©s</button>
        <button class="mutebtn" onclick="clearAdminMode()" style="margin-left:8px">Kijelentkez√©s</button>
      </div>
    </div>

    <footer>
      <p class="muted">¬© AI Beauty Fix ‚Ä¢ PayPal: atika.76@windowslive.com</p>
    </footer>
  </div>

  <script>
    /* ---------- CONFIG ---------- */
    // Csak itt cser√©ld ki az URL-t a t√©nyleges szerver URL-re (Render/Vercel stb.)
    const SERVER_URL = "https://YOUR_SERVER_URL"; // <-- ide √≠rd be a szervered c√≠m√©t pl. https://ai-beauty-fix.onrender.com

    // ADMIN jelsz√≥ amit te k√©rt√©l ‚Äî a szerver ADMIN_SECRET-nek ugyanilyennek kell lennie!
    const ADMIN_PASSWORD = "Atika19760606of5479";

    /* ---------- ROUTER ---------- */
    function showView(id){
      document.getElementById('uploadSection').style.display = (id==='upload' || id==='') ? 'block' : 'none';
      document.getElementById('pricingSection').style.display = (id==='pricing') ? 'block' : 'none';
      document.getElementById('admin').style.display = (id==='admin') ? 'block' : 'none';
      window.location.hash = '#'+id;
    }
    showView('upload');

    /* ---------- CREDITS & FREE COUNT ---------- */
    function getCredits(){ return Number(localStorage.getItem('aib_credits')||0); }
    function setCredits(n){ localStorage.setItem('aib_credits', String(n)); updateCreditUI(); }
    function updateCreditUI(){ /* optional: update any UI fields if present */ }
    function freeCountToday(){ const k='aib_free_'+(new Date()).toISOString().slice(0,10); return Number(localStorage.getItem(k)||0); }
    function incFreeCount(){ const k='aib_free_'+(new Date()).toISOString().slice(0,10); localStorage.setItem(k,String(freeCountToday()+1)); }

    /* ---------- FILE PREVIEW ---------- */
    const fileInput=document.getElementById('fileInput');
    const preview=document.getElementById('preview');
    const canvas=document.getElementById('canvas');
    const ctx = canvas.getContext ? canvas.getContext('2d') : null;
    let currentImage = null;

    fileInput.addEventListener('change', e=>{
      const f = e.target.files[0];
      if(!f) return;
      if(f.size > 20*1024*1024){ alert('A f√°jl t√∫l nagy (max 20MB)'); return; }
      const url = URL.createObjectURL(f);
      preview.src = url; preview.style.display = 'block'; currentImage = f;
    });

    /* ---------- PROCESS BUTTON (kliens vagy szerver) ---------- */
    document.getElementById('processBtn').addEventListener('click', async ()=>{
      if(!currentImage){ alert('V√°lassz egy k√©pet!'); return; }
      const opt = document.getElementById('optionSelect').value;
      if(opt === 'free'){
        if(freeCountToday() >= 3){ alert('El√©rted a napi ingyenes limitet (3). V√°s√°rolj kreditet vagy el≈ëfizet√©st.'); return; }
        incFreeCount(); simulateLocalRetouch(true);
      } else if(opt === 'credit'){
        if(getCredits() <= 0){ if(confirm('Nincsen el√©g kredited. V√°s√°rolsz most?')) showView('pricing'); return; }
        // ha kreditb≈ël akarod szerveres feldolgoz√°sra k√ºldeni:
        await sendToServer(false);
      } else { // paynow
        showView('pricing'); alert('V√°lassz egy csomagot √©s fizesd ki a PayPal gombbal.'); return;
      }
    });

    /* ---------- LOCAL SIMULATED RETOUCH (demo, v√≠zjellel) ---------- */
    function simulateLocalRetouch(watermarked){
      if(!ctx){ alert('A b√∂ng√©sz≈ëd nem t√°mogatja a sz√ºks√©ges canvas API-t.'); return; }
      const img = new Image();
      img.onload = ()=>{
        canvas.width = img.width; canvas.height = img.height; ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(img,0,0);
        try{ ctx.filter='contrast(1.06) saturate(1.05)'; ctx.drawImage(canvas,0,0); }catch(e){}
        const tmp=document.createElement('canvas'); tmp.width=Math.max(1,Math.floor(img.width*0.5)); tmp.height=Math.max(1,Math.floor(img.height*0.5));
        const tctx=tmp.getContext('2d'); tctx.drawImage(canvas,0,0,tmp.width,tmp.height); ctx.drawImage(tmp,0,0,img.width,img.height);
        ctx.globalCompositeOperation='soft-light'; ctx.fillStyle='rgba(255,240,220,0.02)'; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.globalCompositeOperation='source-over';
        if(watermarked) applyWatermarkToCanvas();
        const dataUrl = canvas.toDataURL('image/jpeg',0.92);
        document.getElementById('resultImg').src = dataUrl;
        document.getElementById('resultImg').style.display = 'block';
        document.getElementById('resultWrap').style.display = 'block';
        document.getElementById('downloadBtn').href = dataUrl;
      };
      img.src = URL.createObjectURL(currentImage);
    }

    function applyWatermarkToCanvas(){
      if(!ctx) return;
      const txt='AI Beauty Fix';
      ctx.font='36px system-ui'; ctx.fillStyle='rgba(255,255,255,0.12)'; ctx.textAlign='left';
      ctx.fillText(txt,20,canvas.height-40);
      const data = canvas.toDataURL('image/jpeg',0.92);
      document.getElementById('resultImg').src = data;
      document.getElementById('downloadBtn').href = data;
    }

    /* ---------- SERVER UPLOAD (Replicate processing) ---------- */
    async function sendToServer(expectWatermark){
      try{
        if(!SERVER_URL || SERVER_URL.includes('YOUR_SERVER_URL')){ alert('A szerver URL nincs be√°ll√≠tva. Cser√©ld ki a SERVER_URL v√°ltoz√≥t az index.html elej√©n.'); return; }
        const form = new FormData();
        form.append('file', currentImage);
        // include user's email (optional) for credit tracking
        const userEmail = localStorage.getItem('aib_user_email') || '';
        form.append('email', userEmail);

        // if admin mode active, send admin token header
        const adminToken = localStorage.getItem('aib_admin_token') || null;

        const res = await fetch(SERVER_URL + '/api/upload', {
          method: 'POST',
          headers: adminToken ? { 'x-admin-token': adminToken } : {},
          body: form
        });

        if(res.status === 402){
          alert('Nincs el√©g kredit. V√°s√°rolj a Pricing oldalon.');
          return;
        }
        if(!res.ok){
          const txt = await res.text();
          alert('Hiba a szerver feldolgoz√°sban: ' + txt);
          return;
        }
        const json = await res.json();
        // expected: { ok:true, data: "data:image/jpeg;base64,..." }
        if(json && json.data){
          document.getElementById('resultImg').src = json.data;
          document.getElementById('resultImg').style.display = 'block';
          document.getElementById('resultWrap').style.display = 'block';
          // hide watermark if server returned watermark-free
          document.getElementById('wmTag').style.display = 'none';
        } else {
          alert('Szerver v√°lasz nem √©rtelmezhet≈ë.');
        }
      }catch(err){ console.error(err); alert('H√°l√≥zati hiba: ' + err.message); }
    }

    /* ---------- PAYPAL Buttons integration (create-order via server) ---------- */
    // RENDER: a k√∂vetkez≈ë k√≥d l√©trehozza a PayPal gombot √©s a szerverrel dolgozik egy√ºtt.
    paypal.Buttons({
      style: { layout: 'vertical', color: 'gold', shape: 'rect', label:'pay' },
      createOrder: async function(data, actions){
        // pl: v√°s√°rl√°si opci√≥: 10 kredit = 1490 HUF (tedd testre)
        // itt a szervernek kell l√©trehoznia a PayPal order-t; itt demo: √∂sszeg 1490
        const body = { item: '10_kredit', amount: 1490 };
        const resp = await fetch(SERVER_URL + '/api/create-order', {
          method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify(body)
        });
        if(!resp.ok){ const t=await resp.text(); alert('Hiba create-order: '+t); throw new Error('create-order failed'); }
        const json = await resp.json();
        return json.orderID; // PayPal SDK folytatja
      },
      onApprove: async function(data, actions){
        // capture via server
        const resp = await fetch(SERVER_URL + '/api/capture-order', {
          method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify({ orderID: data.orderID, email: localStorage.getItem('aib_user_email') || '' })
        });
        const json = await resp.json();
        if(json && json.ok){
          alert('K√∂sz√∂nj√ºk! A fizet√©s sikeres. A kreditek j√≥v√°√≠r√°sra ker√ºltek.');
          // friss√≠tsd a helyi credits √°llapotot (szerverben is megt√∂rt√©nik)
          // opcional: lek√©rheted a szervert≈ël a friss kredit √°ll√°st
        } else { alert('Fizet√©s feldolgoz√°sa sikertelen.'); }
      },
      onError: function(err){
        console.error('PayPal error', err);
        alert('PayPal hiba: ' + (err && err.message ? err.message : JSON.stringify(err)));
      }
    }).render('#paypal-button-container');

    /* ---------- ADMIN quick mode (client-side) ---------- */
    function setAdminMode(){
      const pw = prompt('Add meg az admin jelsz√≥t:');
      if(pw === ADMIN_PASSWORD){
        // store admin flag and admin token (token equals password in this demo)
        localStorage.setItem('aib_is_admin','1');
        localStorage.setItem('aib_admin_token', ADMIN_PASSWORD); // server's ADMIN_SECRET must match this
        alert('Admin m√≥d aktiv√°lva ezen a b√∂ng√©sz≈ën.');
        // grant local credits display (doesn't affect server)
        setCredits(999999);
        location.reload();
      } else alert('Hib√°s jelsz√≥.');
    }
    function clearAdminMode(){ localStorage.removeItem('aib_is_admin'); localStorage.removeItem('aib_admin_token'); alert('Admin m√≥d kikapcsolva.'); location.reload(); }

    /* ---------- ONLOAD / PayPal return handler (demo) ---------- */
    (function handleReturn(){
      const qp = new URLSearchParams(location.search);
      if(qp.get('paid') === '1'){
        const pack = qp.get('pack'), add = pack ? Number(pack) : 0;
        if(add) { setCredits(getCredits() + add); alert('Kifizet√©s (demo) feldolgozva: +'+add+' kredit.'); }
      }
    })();

  </script>
</body>
</html>
